image: docker-reg.devops.xiaohongshu.com/fulishe/ci:$CI_IMAGE_VERSION

variables:
  DOCKER_IMAGE_NAME: 'nfs-server'

stages:
  - deploy

deploy:release:
  stage: deploy
  image: docker-reg.devops.xiaohongshu.com/library/docker:latest
  services:
    - docker:dind
  script:
    - echo "Xiaohongshu@123" | docker login docker-reg.devops.xiaohongshu.com --username shequfaas --password-stdin
    - docker build -t docker-reg.devops.xiaohongshu.com/fulishe/$DOCKER_IMAGE_NAME:${CI_COMMIT_REF_NAME} .
    - docker push docker-reg.devops.xiaohongshu.com/fulishe/$DOCKER_IMAGE_NAME:${CI_COMMIT_REF_NAME}
  only:
    - /^\d+(\.\d+)+$/


